FROM ubuntu:20.04
ENV DEBIAN_FRONTEND noninteractve

# install monetdb build dependencies
RUN apt-get update && \
    apt-get install -y cmake python3-dev python3-pip curl bison libpcre3-dev libssl-dev

# download and extract monetdb
WORKDIR /tmp 
RUN curl -O https://dev.monetdb.org/hg/MonetDB/archive/oscar.tar.bz2 
RUN tar jxvf oscar.tar.bz2 
RUN mkdir /tmp/MonetDB-oscar/build
WORKDIR /tmp/MonetDB-oscar/build 
RUN cmake .. -DWITH_CRYPTO=OFF -DINT128=ON -DPY3INTEGRATION=OFF
RUN make -j 4 
RUN make install 

# preinstall dependencies
RUN pip3 install --upgrade pip pytest numpy pandas mypy pycodestyle

# add shared libraries to wheels
ENV LD_LIBRARY_PATH "${LD_LIBRARY_PATH}:/usr/local/lib"

